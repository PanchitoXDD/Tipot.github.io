<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tipot</title>

<style>
body{
    margin:0;
    background:black;
    overflow:hidden;
    font-family:sans-serif;
}

.scoreboard{
    position:absolute;
    top:10px;
    right:20px;
    color:white;
    font-size:22px;
    text-align:right;
}

#skinsBtn,#leaderboardBtn{
    position:fixed;
    bottom:20px;
    left:20px;
    background:#222;
    color:white;
    border:1px solid white;
    padding:10px;
    cursor:pointer;
}

#leaderboardBtn{ left:120px; }

#timer{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    color:white;
    font-family:monospace;
}

.tetera{
    position:absolute;
    width:200px;
    cursor:pointer;
}

.clone{ filter:brightness(70%); }
</style>
</head>

<body>

<div class="scoreboard">
TIPOTS: <span id="tipots">0</span><br>
Record: <span id="record">0</span><br>
CODS: <span id="cods">0</span>
</div>

<button id="skinsBtn">Skins</button>
<button id="leaderboardBtn">Leaderboard</button>

<div id="timer">Click the teapot</div>
<img id="tetera" class="tetera">

<script>
const tipotsSpan=document.getElementById("tipots");
const recordSpan=document.getElementById("record");
const codsSpan=document.getElementById("cods");
const timerDiv=document.getElementById("timer");
const tetera=document.getElementById("tetera");

let tipots=0;
let record=parseInt(localStorage.getItem("record")||"0");
let cods=parseFloat(localStorage.getItem("cods")||"0");
let timer=null;
let playerName=null;

recordSpan.textContent=record;
codsSpan.textContent=cods.toFixed(2);

const skins={
    Teapot:"./skins/Teapot.png",
    Teakettle:"./skins/TeakettleTipotSkin1.png",
    Doge:"./skins/Doge.png"
};

let savedSkin=localStorage.getItem("selectedSkin")||"Teapot";
tetera.src=skins[savedSkin]||skins.Teapot;

document.getElementById("skinsBtn").onclick=()=>window.open("skins.html","_blank");
document.getElementById("leaderboardBtn").onclick=()=>window.open("leaderboard.html","_blank");

// TELEPORT
function teleport(el){
    const x=Math.random()*(window.innerWidth-200);
    const y=Math.random()*(window.innerHeight-200);
    el.style.left=x+"px";
    el.style.top=y+"px";
}

teleport(tetera);

function updateCODS(){
    cods=record/10;
    codsSpan.textContent=cods.toFixed(2);
    localStorage.setItem("cods",cods);
}

function updateLeaderboard(name){
    let lb=JSON.parse(localStorage.getItem("leaderboard")||"[]");
    lb.push({name,score:record});
    lb.sort((a,b)=>b.score-a.score);
    lb=lb.slice(0,50);
    localStorage.setItem("leaderboard",JSON.stringify(lb));
}

function saveRecord(){
    localStorage.setItem("record",record);
    if(!playerName) playerName=prompt("Nombre para leaderboard:")||"Jugador";
    updateLeaderboard(playerName);
}

function startTimer(){
    clearInterval(timer);
    const start=Date.now();

    timer=setInterval(()=>{
        const left=5-(Date.now()-start)/1000;
        timerDiv.textContent=left.toFixed(2);

        if(left<=0){
            clearInterval(timer);

            if(tipots>=record) saveRecord();

            tipots=0;
            tipotsSpan.textContent=0;
            playerName=null;
            timerDiv.textContent="Game Over";

            document.querySelectorAll(".clone").forEach(c=>c.remove());

            setTimeout(()=>timerDiv.textContent="Click the teapot",2000);
        }
    },16);
}

function onClick(e){
    const el=e.currentTarget;
    const original=(el.id==="tetera");

    if(original){
        tipots++;
        tipotsSpan.textContent=tipots;

        if(tipots>record){
            record=tipots;
            recordSpan.textContent=record;
            updateCODS();
        }

        startTimer();
    }

    teleport(el);

    if(original && tipots>=30){
        const clone=el.cloneNode(true);
        clone.classList.add("clone");
        clone.removeAttribute("id");
        teleport(clone);
        document.body.appendChild(clone);
        clone.onclick=onClick;
    }
}

tetera.onclick=onClick;
</script>

</body>
</html>
